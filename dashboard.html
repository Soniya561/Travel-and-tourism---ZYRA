<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zyra Travels — Dashboard</title>

  <!-- Icons & Fonts -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet"/>

  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --primary-color:#2E8B57;
      --secondary-color:#3CB371;
      --light-green:#F0FFF0;
      --text-dark:#2F4F2F;
      --text-light:#6B8E6B;
      --white:#FFFFFF;
      --gray-50:#FAFAFA;
      --gray-100:#F2F4F6;
      --gray-200:#E9ECEF;
      --danger:#D9534F;
      --warning:#F0AD4E;
      --blue:#1E90FF;
      --gold:#FFD700;

      --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:'Inter',sans-serif;
      color:var(--text-dark);
      background:
        linear-gradient(rgba(46,139,87,.25), rgba(60,179,113,.25)),
        url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=2070&q=80') center/cover fixed no-repeat;
      min-height:100vh;
    }

    /* Header */
    .header{
      position:sticky;top:0;z-index:1000;
      background:rgba(255,255,255,.96);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(46,139,87,.12);
      box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    .nav{
      max-width:1300px;margin:0 auto;padding: .9rem 1.2rem;
      display:flex;align-items:center;justify-content:space-between;gap:1rem;
    }
    .brand{
      display:flex;align-items:center;gap:.65rem;text-decoration:none;
    }
    .brand-logo{
      font-family:'Playfair Display',serif;font-weight:700;font-size:1.6rem;color:var(--primary-color);
    }
    .brand small{color:var(--text-light)}
    .nav-actions{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
    .search{
      display:flex;align-items:center;gap:.5rem;background:#fff;border:1px solid var(--gray-200);
      border-radius:999px;padding:.4rem .8rem;min-width:240px;
    }
    .search input{border:none;outline:none;width:160px;font-size:.95rem}
    .pill{
      padding:.35rem .7rem;border-radius:999px;font-weight:600;font-size:.85rem;border:1px solid #E8F5E8;color:var(--primary-color);background:#E8F5E8;
    }
    .avatar{
      width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;
      color:#fff;background:var(--gradient-primary);font-weight:700
    }

    /* Shell layout */
    .shell{
      max-width:1300px;margin:1.2rem auto;display:grid;grid-template-columns:280px 1fr;gap:1.2rem;padding:0 1.2rem 1.6rem;
    }
    .card{
      background:rgba(255,255,255,.96);border:1px solid rgba(46,139,87,.12);border-radius:16px;
      box-shadow:0 16px 40px rgba(0,0,0,.08);
    }

    /* Sidebar */
    .sidebar{position:sticky;top:84px;height:fit-content}
    .menu{list-style:none;padding:.8rem}
    .menu a{
      display:flex;align-items:center;gap:.75rem;text-decoration:none;color:var(--text-light);
      padding:.7rem .9rem;border-radius:12px;font-weight:600;
    }
    .menu a:hover{background:#F8FFFA;color:var(--primary-color);transform:translateX(2px)}
    .menu a.active{background:var(--gradient-primary);color:#fff}
    .menu i{width:20px;text-align:center}

    /* Main content */
    .main{display:flex;flex-direction:column;gap:1.2rem}

    .hero{
      padding:1.4rem 1.4rem 1.2rem;position:relative;overflow:hidden
    }
    .hero h1{font-family:'Playfair Display',serif;font-size:1.8rem;margin-bottom:.35rem}
    .hero p{color:var(--text-light)}
    .hero-cta{margin-top:.8rem;display:flex;gap:.6rem;flex-wrap:wrap}
    .btn{
      border:none;border-radius:10px;padding:.55rem .9rem;cursor:pointer;font-weight:700;
      display:inline-flex;align-items:center;gap:.5rem
    }
    .btn.primary{background:var(--gradient-primary);color:#fff}
    .btn.light{background:#E9F7EE;color:var(--primary-color);border:1px solid #cfe9d7}
    .btn.red{background:var(--danger);color:#fff}

    /* Stats */
    .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:.9rem}
    .stat{padding:1rem}
    .stat .k{font-size:1.6rem;font-weight:800}
    .stat .l{color:var(--text-light)}
    .stat .icon{
      width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;margin-bottom:.6rem
    }
    .icon.green{background:var(--primary-color)}
    .icon.gold{background:linear-gradient(135deg,#FFD700,#FFA500)}
    .icon.blue{background:linear-gradient(135deg,#1E90FF,#4169E1)}
    .icon.pink{background:linear-gradient(135deg,#FF69B4,#FF85C2)}

    /* Grids */
    .grid-2{display:grid;grid-template-columns:1.1fr .9fr;gap:.9rem}
    .section{padding:1rem}
    .section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:.7rem}
    .section-title{font-weight:800;color:var(--text-dark)}
    .chip{font-size:.8rem;background:#F5FFF8;color:var(--primary-color);border:1px solid #dcefe4;padding:.25rem .5rem;border-radius:999px}

    /* Lists */
    .trip{display:grid;grid-template-columns:1fr auto;gap:.4rem;padding:.7rem;border:1px dashed #cfe9d7;border-radius:12px;margin-bottom:.5rem;background:#FAFFFC}
    .trip strong{font-weight:700}
    .muted{color:var(--text-light);font-size:.93rem}
    .status{font-size:.8rem;font-weight:700;padding:.25rem .5rem;border-radius:8px}
    .status.upcoming{background:#1E90FF;color:#fff}
    .status.completed{background:var(--primary-color);color:#fff}
    .status.delayed{background:#F0AD4E;color:#412400}
    .row{display:flex;align-items:center;gap:.4rem;flex-wrap:wrap}
    .row .btn{padding:.4rem .6rem;border-radius:8px}

    /* Rewards */
    .progress{height:10px;background:#f0f5f2;border-radius:999px;overflow:hidden}
    .progress > div{height:100%;background:linear-gradient(135deg,#FFD700,#FFA500);width:0%;transition:width .6s ease}

    /* Notifications */
    .note{display:flex;gap:.6rem;padding:.6rem;border:1px solid var(--gray-200);border-radius:12px;margin-bottom:.5rem;background:#fff}
    .note i{margin-top:.15rem}
    .note.warn{border-color:#FFE4BF;background:#FFF8E9;color:#7b4b00}
    .note.danger{border-color:#F7D6D4;background:#FDECEA;color:#8a2a28}
    .note.info{border-color:#cfe9d7;background:#F5FFF8;color:#2F4F2F}

    /* Quick links */
    .quick{display:grid;grid-template-columns:repeat(4,1fr);gap:.9rem}
    .ql{padding:1rem;display:flex;flex-direction:column;gap:.5rem}
    .ql p{color:var(--text-light)}
    .ql:hover{transform:translateY(-3px);transition:.2s ease}

    /* Charts canvas */
    canvas{max-width:100%}

    /* Footer */
    .footer{color:var(--text-light);text-align:center;margin-top:.6rem;font-size:.9rem}

    /* Responsive */
    @media (max-width:1100px){
      .shell{grid-template-columns:1fr}
      .grid-2{grid-template-columns:1fr}
      .stats{grid-template-columns:repeat(2,1fr)}
      .quick{grid-template-columns:repeat(2,1fr)}
      .sidebar{position:relative;top:0}
    }
    @media (max-width:620px){
      .stats{grid-template-columns:1fr}
      .quick{grid-template-columns:1fr}
      .search{min-width:0;width:100%}
      .search input{width:100%}
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="nav">
      <a href="index.html" class="brand">
        <div class="brand-logo"><i class="fa-solid fa-location-dot"></i> Zyra</div>
        <small>Smart travel, safer journeys</small>
      </a>
      <div class="nav-actions">
        <div class="search">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input id="globalSearch" placeholder="Search trips, bookings, places"/>
        </div>
        <span id="greet" class="pill">Welcome</span>
        <div class="avatar">ZT</div>
      </div>
    </div>
  </header>

  <div class="shell">
    <!-- Sidebar -->
    <aside class="sidebar card">
      <ul class="menu">
        <li><a class="active" href="dashboard.html"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
        <li><a href="booking.html"><i class="fa-solid fa-ticket"></i> Bookings</a></li>
        <li><a href="hotel-booking.html"><i class="fa-solid fa-bed"></i> Hotels</a></li>
        <li><a href="services.html"><i class="fa-solid fa-compass"></i> Services</a></li>
        <li><a href="reviews.html"><i class="fa-solid fa-star"></i> Reviews</a></li>
        <li><a href="weather-standalone.html"><i class="fa-solid fa-cloud-sun"></i> Weather</a></li>
        <li><a href="geofencing.html"><i class="fa-solid fa-map-location-dot"></i> Geofencing</a></li>
        <li><a href="digital-id.html"><i class="fa-solid fa-id-card"></i> Digital ID</a></li>
        <li><a href="faq.html"><i class="fa-solid fa-circle-question"></i> FAQ</a></li>
        <li><a href="contact.html"><i class="fa-solid fa-headset"></i> Support</a></li>
        <li><a href="login.html"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
      </ul>
    </aside>

    <!-- Main content -->
    <main class="main">
      <!-- Hero -->
      <section class="hero card">
        <h1 id="welcomeTitle">Good day, Traveler</h1>
        <p>Plan, track and optimize your trips with Zyra. Your loyalty benefits and safety tools are just a click away.</p>
        <div class="hero-cta">
          <a href="booking.html" class="btn primary"><i class="fa-solid fa-plus"></i> Plan a new trip</a>
          <a href="geofencing.html" class="btn light"><i class="fa-solid fa-bell"></i> Enable geofencing alerts</a>
          <a href="weather-standalone.html" class="btn light"><i class="fa-solid fa-cloud-sun"></i> Check weather</a>
        </div>
      </section>

      <!-- Stats -->
      <section class="stats">
        <div class="stat card">
          <div class="icon green"><i class="fa-solid fa-suitcase-rolling"></i></div>
          <div class="k" id="statUpcoming">3</div>
          <div class="l">Upcoming Trips</div>
        </div>
        <div class="stat card">
          <div class="icon gold"><i class="fa-solid fa-coins"></i></div>
          <div class="k" id="statPoints">1,250</div>
          <div class="l">Reward Points</div>
        </div>
        <div class="stat card">
          <div class="icon blue"><i class="fa-solid fa-piggy-bank"></i></div>
          <div class="k" id="statSavings">$312</div>
          <div class="l">Savings this year</div>
        </div>
        <div class="stat card">
          <div class="icon pink"><i class="fa-solid fa-shield-heart"></i></div>
          <div class="k" id="statSafety">On</div>
          <div class="l">Safety Tools</div>
        </div>
      </section>

      <!-- Charts -->
      <section class="grid-2">
        <div class="section card">
          <div class="section-head">
            <h3 class="section-title"><i class="fa-solid fa-chart-pie" style="color:var(--primary-color)"></i> Trip Categories</h3>
            <span class="chip">Last 12 months</span>
          </div>
          <canvas id="chartTrips" height="140"></canvas>
        </div>

        <div class="section card">
          <div class="section-head">
            <h3 class="section-title"><i class="fa-solid fa-chart-column" style="color:var(--primary-color)"></i> Monthly Spend</h3>
            <span class="chip">USD</span>
          </div>
          <canvas id="chartSpend" height="140"></canvas>
        </div>
      </section>

      <!-- Trips + Rewards -->
      <section class="grid-2">
        <div class="section card">
          <div class="section-head">
            <h3 class="section-title"><i class="fa-solid fa-route" style="color:var(--primary-color)"></i> Upcoming Trips</h3>
            <a href="booking.html" class="btn light"><i class="fa-solid fa-plus"></i> Add</a>
          </div>

          <div id="tripsList">
            <!-- Trip 1 -->
            <div class="trip">
              <div>
                <strong>Paris Getaway</strong>
                <div class="muted"><i class="fa-regular fa-calendar"></i> 18–22 Oct • <i class="fa-solid fa-plane-departure"></i> SFO → CDG</div>
              </div>
              <div class="row">
                <span class="status upcoming">Upcoming</span>
                <a class="btn light" href="booking.html"><i class="fa-solid fa-eye"></i> View</a>
                <a class="btn primary" href="hotel-booking.html"><i class="fa-solid fa-bed"></i> Hotel</a>
              </div>
            </div>
            <!-- Trip 2 -->
            <div class="trip">
              <div>
                <strong>Goa Beach Break</strong>
                <div class="muted"><i class="fa-regular fa-calendar"></i> 08–12 Nov • <i class="fa-solid fa-plane-departure"></i> HYD → GOI</div>
              </div>
              <div class="row">
                <span class="status upcoming">Upcoming</span>
                <a class="btn light" href="booking.html"><i class="fa-solid fa-eye"></i> View</a>
                <a class="btn primary" href="services.html"><i class="fa-solid fa-compass"></i> Explore</a>
              </div>
            </div>
            <!-- Trip 3 -->
            <div class="trip">
              <div>
                <strong>Kyoto Culture Trail</strong>
                <div class="muted"><i class="fa-regular fa-calendar"></i> 01–06 Dec • <i class="fa-solid fa-plane-departure"></i> DEL → KIX</div>
              </div>
              <div class="row">
                <span class="status delayed">Date Hold</span>
                <a class="btn light" href="booking.html"><i class="fa-solid fa-pen"></i> Edit</a>
                <a class="btn primary" href="weather-standalone.html"><i class="fa-solid fa-cloud"></i> Weather</a>
              </div>
            </div>
          </div>
        </div>

        <div class="section card">
          <div class="section-head">
            <h3 class="section-title"><i class="fa-solid fa-crown" style="color:var(--primary-color)"></i> Rewards & Benefits</h3>
            <span class="chip" id="tierChip">Silver</span>
          </div>
          <div class="muted" style="margin-bottom:.5rem">Points to next tier</div>
          <div class="progress" style="margin-bottom:.6rem">
            <div id="progressBar"></div>
          </div>
          <div class="row" style="margin-bottom:.6rem">
            <span class="pill"><i class="fa-solid fa-gift"></i> 1,250 pts</span>
            <span class="pill" style="background:#FFF8E9;border-color:#FFE4BF;color:#7b4b00"><i class="fa-solid fa-bolt"></i> Tier Boost</span>
          </div>
          <ul style="list-style:none;display:grid;gap:.5rem">
            <li class="note info"><i class="fa-solid fa-check"></i> 10% off on hotels via Zyra</li>
            <li class="note info"><i class="fa-solid fa-check"></i> Priority support on travel changes</li>
            <li class="note info"><i class="fa-solid fa-check"></i> Free geofencing alerts & safety tools</li>
          </ul>
        </div>
      </section>

      <!-- Notifications + Quick links -->
      <section class="grid-2">
        <div class="section card">
          <div class="section-head">
            <h3 class="section-title"><i class="fa-solid fa-bell" style="color:var(--primary-color)"></i> Notifications</h3>
            <button id="clearNotes" class="btn light"><i class="fa-solid fa-xmark"></i> Clear</button>
          </div>
          <div id="notes">
            <div class="note warn"><i class="fa-solid fa-triangle-exclamation"></i> Passport expiring in 45 days. Consider renewal.</div>
            <div class="note info"><i class="fa-solid fa-circle-info"></i> Deal: Save up to 20% on autumn stays.</div>
            <div class="note danger"><i class="fa-solid fa-circle-exclamation"></i> Weather alert for Goa on 9 Nov.</div>
          </div>
        </div>

        <div class="section card">
          <div class="section-head">
            <h3 class="section-title"><i class="fa-solid fa-bolt" style="color:var(--primary-color)"></i> Quick Links</h3>
          </div>
          <div class="quick">
            <a class="ql card" href="booking.html">
              <strong><i class="fa-solid fa-plus"></i> New Booking</strong>
              <p>Flights, hotels, packages</p>
            </a>
            <a class="ql card" href="services.html">
              <strong><i class="fa-solid fa-compass"></i> Explore</strong>
              <p>Top destinations & tours</p>
            </a>
            <a class="ql card" href="geofencing.html">
              <strong><i class="fa-solid fa-shield-halved"></i> Safety</strong>
              <p>Boundary alerts & tracking</p>
            </a>
            <a class="ql card" href="weather-standalone.html">
              <strong><i class="fa-solid fa-cloud-sun"></i> Weather</strong>
              <p>Plan with live conditions</p>
            </a>
          </div>
        </div>
      </section>

      <div class="footer">© <span id="year"></span> Zyra Travels — Travel smarter, stay safer.</div>
    </main>
  </div>

  <script>
    // Basic brand state (could be replaced by real data later)
    const state = {
      points: Number(localStorage.getItem('zyra_points') || 1250),
      upcomingTrips: 3,
      savingsUSD: 312,
      safetyOn: true,
      spendMonthly: [420, 280, 350, 500, 620, 410, 300, 540, 480, 530, 610, 580],
      tripCategories: { Leisure: 9, Business: 4, Adventure: 5, Family: 3 }
    };

    // Helpers
    const $ = (sel) => document.querySelector(sel);
    const setText = (sel, text) => { const el = $(sel); if (el) el.textContent = text; };

    function humanNumber(n){
      // Format numbers like 1,250 or 1.2k
      if (n >= 1000) return (n/1000).toFixed(n % 1000 === 0 ? 0 : 1) + 'k';
      return n.toLocaleString();
    }

    function greet(){
      const h = new Date().getHours();
      return h < 12 ? 'Good morning' : h < 17 ? 'Good afternoon' : 'Good evening';
    }

    async function updateHeader(){
      setText('#greet', greet());

      // Try to fetch user data from backend first
      try {
        const response = await fetch('/api/auth/me');
        if (response.ok) {
          const userData = await response.json();
          const name = userData.name || localStorage.getItem('zyra_name') || 'Traveler';
          setText('#welcomeTitle', `${greet()}, ${name}`);
          // Update localStorage with fresh data
          localStorage.setItem('zyra_name', name);
          localStorage.setItem('zyra_email', userData.email);
        } else {
          // Fallback to localStorage
          const name = localStorage.getItem('zyra_name') || 'Traveler';
          setText('#welcomeTitle', `${greet()}, ${name}`);
        }
      } catch (error) {
        // Fallback to localStorage if API fails
        const name = localStorage.getItem('zyra_name') || 'Traveler';
        setText('#welcomeTitle', `${greet()}, ${name}`);
      }

      setText('#year', new Date().getFullYear());
    }

    function updateStats(){
      setText('#statUpcoming', state.upcomingTrips);
      setText('#statPoints', humanNumber(state.points));
      setText('#statSavings', '$' + state.savingsUSD.toLocaleString());
      setText('#statSafety', state.safetyOn ? 'On' : 'Off');

      // Rewards tier logic
      const tierChip = $('#tierChip');
      const bar = $('#progressBar');
      // Example thresholds
      const tiers = [{name:'Bronze',min:0},{name:'Silver',min:1000},{name:'Gold',min:2000},{name:'Platinum',min:4000}];
      let tier = tiers[0].name, nextMin = tiers[1].min;
      for (let i=0;i<tiers.length;i++){
        if (state.points >= tiers[i].min){
          tier = tiers[i].name;
          nextMin = tiers[i+1]?.min ?? tiers[i].min;
        }
      }
      const progress = Math.max(5, Math.min(100, Math.round( ( (state.points - (nextMin === state.points ? state.points : (tiers.find(t => t.name===tier).min)) ) / Math.max(1, nextMin - tiers.find(t => t.name===tier).min) ) * 100 )));
      tierChip.textContent = tier;
      bar.style.width = (tier === 'Platinum' ? 100 : progress) + '%';
    }

    function initCharts(){
      const cs = getComputedStyle(document.documentElement);
      const primary = cs.getPropertyValue('--primary-color').trim();
      const secondary = cs.getPropertyValue('--secondary-color').trim();

      // Trip categories pie
      const ctx1 = document.getElementById('chartTrips');
      if (ctx1){
        new Chart(ctx1, {
          type: 'doughnut',
          data: {
            labels: Object.keys(state.tripCategories),
            datasets: [{
              data: Object.values(state.tripCategories),
              backgroundColor: [
                primary,
                '#1E90FF',
                '#8A2BE2',
                '#FF6B35'
              ],
              borderWidth: 0
            }]
          },
          options: {
            plugins: {
              legend: { display: true, position: 'bottom' }
            },
            cutout: '60%'
          }
        });
      }

      // Monthly spend bar
      const ctx2 = document.getElementById('chartSpend');
      if (ctx2){
        new Chart(ctx2, {
          type: 'bar',
          data: {
            labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
            datasets: [{
              label: 'Spend (USD)',
              data: state.spendMonthly,
              backgroundColor: secondary,
              borderRadius: 8
            }]
          },
          options: {
            scales: {
              y: { beginAtZero: true, ticks: { callback: (v) => '$' + v } }
            },
            plugins: {
              legend: { display: false }
            }
          }
        });
      }
    }

    function wireUp(){
      // Clear notifications
      const clearBtn = document.getElementById('clearNotes');
      if (clearBtn){
        clearBtn.addEventListener('click', () => {
          const box = document.getElementById('notes');
          box.innerHTML = '<div class="note info"><i class="fa-solid fa-circle-info"></i> All caught up. No new alerts.</div>';
        });
      }

      // Simple search navigation helper (client-side)
      const search = document.getElementById('globalSearch');
      if (search){
        search.addEventListener('keydown', (e) => {
          if (e.key === 'Enter'){
            const q = (search.value||'').toLowerCase().trim();
            if (!q) return;
            if (q.includes('book')) location.href = 'booking.html';
            else if (q.includes('hotel')) location.href = 'hotel-booking.html';
            else if (q.includes('weather')) location.href = 'weather-standalone.html';
            else if (q.includes('geo')) location.href = 'geofencing.html';
            else if (q.includes('id')) location.href = 'digital-id.html';
            else if (q.includes('support') || q.includes('contact')) location.href = 'contact.html';
            else if (q.includes('review')) location.href = 'reviews.html';
            else location.href = 'services.html';
          }
        });
      }
    }

    // Init
    (async () => {
      await updateHeader();
      updateStats();
      initCharts();
      wireUp();
    })();
  </script>
 
<script src="/js/location.js"></script>
<script>
(function(){
  function sendLocation() {
    const token = localStorage.getItem('token');
    if (!navigator.geolocation || !token) return;

    navigator.geolocation.getCurrentPosition(async (pos) => {
      const { latitude: lat, longitude: lng } = pos.coords;
      try {
        await fetch('http://localhost:3000/users/me/location', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ lat, lng })
        });
      } catch (e) { /* ignore */ }
    });
  }
  setInterval(sendLocation, 60000); // every 1 min
  sendLocation();
})();
</script>

</body>
</html>


